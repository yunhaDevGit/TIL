# Kafka Producer

프로듀서는 보통 카프카 프로듀서 API와 그것으로 구성된 애플리케이션을 말합니다. 
프로듀서는 브로커에 특정 토픽(혹은 파티션 영역까지)을 지정하여 메시지를 전달하는 역할을 담당합니다. 
프로듀서를 통해 전달되는 메시지의 구조는 다음과 같습니다.

![](https://blog.kakaocdn.net/dn/bWu9oA/btqCID10W4o/38swwAWyFmHY46eBtJuqM1/img.png)

 
 ### 프로듀서 구조와 메시지 전달 과정
 - 프로듀서는 아래의 4가지 과정을 통해 브로커에게 메시지를 전달합니다. 
1. 직렬화 (Serializer)
2. 파티셔닝 (Partitioner)
3. 메시지 배치 (Record Accumulator)
4. 압축 (Compression)
5. 전달 (Sender)

![](https://blog.kakaocdn.net/dn/XvurH/btqCJlT9MAh/zZK1T4QjFh3aTqibOMXRuk/img.png)

각 과정을  천천히 살펴보겠습니다. 
프로듀서는 먼저, 전달 요청 받은 메시지를 직렬화합니다. 
직렬화는 Serializer가 지정된 설정을 통해 처리하며, **메시지의 키와 같은 바이트 뭉치 형태로 변환됩니다.** 

직렬화 과정을 마친 메시지는 Partitioner를 통해 **어떤 토픽의 어떤 파티션에 저장 될 지를 결정합니다.** 이 과정을 **파티셔닝(Partitioning)**이라고 합니다. Partitioner는 정의된 로직에 따라 파티셔닝을 진행하는데, 별도의 설정이 없다면 Round Robin 형태로 파티셔닝 합니다. 즉, 파티션들에게 골고루 메시지를 전달하도록 파티셔닝합니다. 
만약, 메시지 전달 요청에 특정 파티션이 지정되어 왔을 경우, 별도의 파티셔닝 없이 해당 파티션으로 전달됩니다.

만약 **메시지 압축이 설정되었다면, 설정된 포멧에 맞춰 메시지를 압축합니다.** 압축된 메시지는 브로커로 빠르게 전달할 수 있을 뿐더러, 브로커 내부에서 빠른 복제가 가능하도록 합니다. 

파티셔닝과 압축을 마친 후, 프로듀서는 프로듀서는 메시지를 TCP 프로토콜을 통해 브로커의 리더 파티션으로 전송합니다. 하지만 네트워크 전송은 매우 무거운 처리이기 때문에 메시지를 매번 네트워크를 통해 전달하는 것은 비효율적입니다.  그래서 **프로듀서는 지정된 만큼 메시지를 저장했다가 한 번에 브로커로 전달합니다.** 이 과정을 내부의 **Record Accumulatro**가 담당하여 처리합니다.     


https://always-kimkim.tistory.com/entry/kafka101-producer?category=876258
