## 코드 리뷰 목적

- 개발 생산성
- **품질 문제 검수 (버그, 장애)**
- 더 나은 코드 품질 : 아키텍처 속성 개선을 위한 코드 개선 (**향후 변경 비용 개선)**
    
    > 클린 코드의 중요성
    -  SW의 진정한 비용 = 유지보수 (전체의 80% 이상)
    -  한번 작성한 코드는 10번 이상 읽힘. 작성할 때보다 이해에 10배 정도의 노력이 필요
    -  실제로 100배 정도의 노력이 필요함
    -  90% 이상의 시간을 코드를 이해하는데 사용... 😢
    > 
- **학습 및 지식 전달 :** 코드, 해결책 등과 관련된 지식 공유에 기여
    - 공유(주고 받는 학습)을 통한 역량 증대 및 성장
    - 참여한 모든 사람들의 배움의 기회
    - 대게의 경우 **리뷰어들도** 리뷰 과정에서 지식을 얻게 됨(하드스킬, 소프트스킬)
    - **동기부여**
- **상호 책임감** 증대
    - 집단 코드 오너십 및 **결속** 증대
    - 내가 하고 있는 일에 관심을 가져주는 것
    - 팀에서 일허나는 일 공유. 내 동료가 무엇을 하나? **팀워크**
- **개발 문화 개선**
- **설계 개선 제안**

## 코드 리뷰의 절차

- 저자(Author)
    - 코드 작성, 리뷰 요청
- 리뷰어
    - 코드를 읽고
    - merge 가능 여부 결정
- 변경 내역(PR)
    - 리뷰 시작 전에 작성
    - 저자가 merge를 원하는 소스 코드에 대한 일련의 변경을 작성..?
    

**고생은 저자가 해야 된다 (리뷰어의 시간을 아껴줘야 제대로 이뤄진다)**

- 저자가 작은 단위로 리뷰하기 좋게 리뷰할 내용을 올려줘야 된다.
- 좋은 pull request의 예
    - 리뷰어들의 시간을 줄일 수 있도록 자세하게 적어야 한다.
    

## 코드 리뷰가 어려운 이유

- 저자
    - 본인 생각에 멋지다고 생각하는 PR을 보냄
- 리뷰어
    - 왜 멋지지 않은지에 대한 장황한 이유를 작성
    
    **→ 코드에 대한 비판을 자신에 대한 비판으로 이해...;;**  (→ 대화가 원활하지 않게 되고 코드 리뷰를 두려워 하게 된다.)
    

## 코드 리뷰?

- 코드 리뷰는
    - 지식/공학적 결정을 공유하는 기회
    - 공유(잘한 것, 아쉬운 것)을 통해 서로의 지식/경험을 나누며 상호 학습을 통한 역량 증대 수단
    - 코드 토의를 개인적 공격으로 받아들이면 안된다
- 생각을 글로 전달하는 것에 대한 어려움
    - 오해의 위험이 크다(음성과 표정이 없기 때문에 공격적으로 받아들일 수 있다)
- 피드백을 조심스럽게 표현하는 것이 더 중요하다!!

## 코드 리뷰 기법들....

### 효율적인 PR(pull request) 방법

- 지루한 작업은 컴퓨터로 처리
    - 컴퓨터가 할 수 있는 일에 노력을 낭비 X
    - ex) Formatting Tool (공백, 들여쓰기 오류 등...)
        - 별도의 커밋/PR로 분리 (불필요한 리뷰 생략)
- 스타일 가이드를 통해 스타일 논쟁 해소
    - 있는 스타일 가이드를 따르거나
    - 자신들만의 스타일 가이드를 만들거나
    - 있는 걸 차용하면서 자기 스타일도 담거나
- PR을 올릴 때 주석 달기
    - PR을 저자가 먼저 읽어보고
- PR 할 때 일부가 아닌 모두를 포함
    - 많은 사람이 볼 수록 버그를 더 잘 찾아낼 수 있다.
- 의미있는 커밋으로 분리
    - 혼자하는 코드 리뷰(2주 후의 내가 다시 보더라도 알아 볼 수 있도록 커밋 작성)
    

### 효율적인 리뷰 방법

- 코드 리뷰를 높은 우선순위로
    - 저자는 리뷰 종료될 때까지 대기 함
- 리뷰를 바로 시작하면 선순환이 일어나게 해라
    - 코드를 읽고 피드백 줄때는 시간을 갖고 하지만 시작은 바로 할 것
- 리뷰 라운드의 최대 시간은 하루
- PR에 포함된 변경이 적도록 노력(코드 리뷰를 자주 해라)
    - 반나절 정도 작업한 양 정도
    - 모든 팀원들이 하루에 두번 작은양의 PR을 리뷰할 수 있고 최대 4시간 안에 리뷰가 완료될 것
    - 근본적인 문제는 사람들이 **리뷰할 시간이 없다고 느낀다**는 것
        - PR을 많이 하는 것은 성과로 보는데 리뷰어로써 남에게 도움을 준 것이 성과로 인정하지 않는 것은 조직적인 문제... 🥲
- 예제 코드 제공에 관대하라
    - 저자를 기분 좋게 하기 위한 방법
    - 너무 긴 예제는 하지 말것
- 고수준으로 시작, 저수쥰우로 내려가라
- 리뷰의 범위를 존중하라
    - PR 근처의 코드만 보고 리뷰 할 것
- 태그를 활용
    - [Nit]
        - ‘고치면 좋지만 아니어도 그만’을 의미
        - 리뷰어는 **항상 더 개선할 수 있는 의견을 자유롭게 남길 수 있어야 함**
- **한두 등급만 코드 레벨을 올리는 것을 목표로 해라**
    - D 등급의 PR을 받으면 저자가 C나 B 등급을 받도록 도울것
    - 완전하지 않더라도 충분히 좋은 코드가 되도록 도와줄것
    - **승인을 보류하는 유일한 이유**
        - 수차례의 리뷰 라운드 후에도 코드가 F(기능적으로 틀렸거나 너무 복잡해서 맞는지 확인이 안되는 경우)인 경우

## 피드백 방법

- 절대 “너”라고 하지 마라(너는 왜 맨날...)
    - 리뷰의 핵심
        - **무엇이 코드를 나아지게 하는가**에 집중
        - 누가 그런 아이디어(잘못)을 냈는지가 아니다!!
    - 저자의 방어 유발을 최소화 하는 방법으로 피드백
        - **비판의 대상은 저자가 아닌 코드다!**
    - “너”만 빼라 (저자에 대한 판단 → 단순 정정)
    - ~하는 것을 제안
- 건설적인 피드백을 해라
    - 동료 간의 코드 리뷰 → 경쟁이 아닌 우리 팀의 **생산성**을 높이는 것
    - 비판이 아닌 **학습의 과정**으로 인지하면 전체적인 프로젝트 성공에 기여함
- 진정한 칭찬을 해라
    - 대부분 리뷰어가 **잘못된 부분에만 집중**
        - but 긍정적 행위 강화를 위한 값진 기회기도 하다
    - 리뷰어가 감시자가 아닌 도와주는 동료라는 느낌을 준다
- 피드백은 명령으로 하지 말것
    - 종종 리뷰에서 강압적인 명령이 발견되지만 안된다!!
    - ~클래스를 별도로 분리해라!!! (X)
    ~클래스를 별도로 분리하는 건 어떨까요?? (O)
- 의견이 아니라 원칙에 기반하여 피드백 하라
    - 리뷰를 제안할 때는 **제안하는 변경**과 **이유**를 모두 설명해라!
    - 무엇을 할 수 있는지 **객관적으로 설명**해라
- 반복적인 패턴에 대해서는 피드백을 제한하라
    - 저자이 실수가 동일한 패턴임을 식별했다면 모든 경우를 언급하지 마라
    - 동일 패턴에 대해 2~3개 정도의 예를 언급하라

## 교착상태 시..

**교착상태로 향하는지 나타내는 표식**

- 토론의 톤이 점차 공격적이게 됨
- 라운드당 커멘트가 줄어들지 않는 경향
- 너무 많은 커멘트에 저항을 보임
- 최악의 경우 커멘트를 반영하지 않으니 승인 거부
- 저자는 커멘트 반영을 거부

→ 만나서 얘기하고 풀 것!

## 코드 리뷰를 재밌게 하는 법

- PR을 작성한 사람과 짝 프로그래밍을 하며 어떻게 고치는게 좋은지 보여주고
- Revert (원복)
- PR을 작성한 사람이 **스스로 개선**할 수 있도록 기회를 주는....
    - 20분 짝 프로그래밍 하고 2시간동안 다시 짤 수도 있음
- 결정은 저자가 한다
    - 팀 정신을 유지하기 위해 불완전환 해결책을 받ㄷ아들여라
    - **모든 설계 결함이 항상 실제로 문제가 되지는 않는다**
- 코드 리뷰의 목적이 **비난이 아닌 배움**이다
- 리뷰하려는 코드가 그냥 나쁠 때가 있음
    - 좀 더 안내하는 가르침으로 전환하라...
    

## 코드 리뷰 문화 정착의 어려움 / 극복 방법

- 온/오프라인의 차이
    - 꾸중 vs 토론
- 저자의 노력이 중요
    - 리뷰어 n명의 시간을 절약
    - 효과적인 리뷰 가능
- **리더의 관심과 의지**
    - 가끔, 그러나 매우 자세히
- 코드 비난에 대한 두려움
- 멋져 보여야 함
    - 하고 싶어짐. 그게 뭐든
    - Tool (IDE, HotKey)
    
- 좌절할 준비를 하라
- 내가 원한다고 남에게 영감을 줄 수 없다
- 당신은 당신 자신의 태도만 제어 가능하다. 타인이 나의 태도에 어떻게 반응할지는 제어 불가
- 영감은 부산물
    - 내가 어떻게 하면 모범이 될 수 있을까?
    - 특정 해동이나 특정 기술을 채택하도록 하려면 모범이 되어야 한다.
    - 기술을 마스터 해야 함
- 모범이 돼라
    - **지각하지 마라**
    - **업무에 기여하라**
    - **긍정적으로 임해라**
    - **사람들을 잘 대하라**
    - **기술적 훈련에 대해 얘기하려면 고도록 숙달 되어야 한다**
- 이렇게 엄청난 모습을 보여주면 아마도 몇몇 사람들에게 영감을 줄 수 있다.

## 코드 리뷰 효과

- 예상하지 못한 버그를 타 프로젝트에서 발경
- 시간이 지나서 선플이 달린다
- 많은 사람이 내가 작성한 코드를 본다는 생각에 PR 전에 한번 더 코드를 다듬게 됨
- 좋은 설게, 아키텍처, 클린코드, TDD 등에 대한 공감대/열정 생성

## 코드리뷰를 잘하기 위한 필요 기술들

- **리펙토링**
    - 결과의 변경 없이 코드의 구조를 재조정
        - 가독성을 높이고 유지보수를 편하게 하는 것
        - 버그를 없애거나 새로운 기능을 추가하는 행위는 아니다
    - TDD와 연결된 리펙토링
        - 돌아가는 코드를 가지고 설계하는 행위
    - 코드리뷰에서 많이 언급하는 기술적 내용
    - 매일 리팩토링
        - 응집도 높이기
        - Comoposed Method(Extract Method) -
        - Discover Value Object
- Legacy Code 다루기
    - 의존성 관리 : Subclass & OVerride Method
    - 테스트 추가 : Characterization Test
    - 새로운 코드 빠르게 추가 :  Sprout/Wrap Mehthd/Class
    - 레거시 분석
- TDD
- Clean Code
    - https://cleancoders.com/

--------
# 한번 듣고 평생 써먹는 코드 리뷰 노하우

OKKY 1월 세미나 참여 안내
한번 듣고 평생 써먹는 코드 리뷰 노하우
2022년 1월 18일(화), 저녁 8시(120분 진행 예정) 온라인(Zoom) 진행

<br>
## 왜 코드 리뷰를 해야 하나?

* S/W 제품의 경우 개발자 수와 개발 생산성이 비례하는 것이 아니라 어느 시점부터는 효율성이 떨어지게 된다.
* S/W 공학은 설계와 빌드로 구분될 수 있으며, S/W 엔지니어는 좋은 설계 및 코드를 작성하는 사람이라고 할 수 있다.
* S/W 비용에 있어서 유지보수가 전체 비용의 80% 이상을 차지하므로 유지보수 작업에 드는 시간을 줄일 수 있다면 총 비용을 줄일 수 있다.

비용 감소 측면을 개발자들이 회사에게 비지니스 관점에서 어필할 수 있다.
=> 그렇다면 어떻게 유지보수 시간을 줄일 수 있을까?
=> 처음부터 좋은 코드! 재사용성이 높은 코드! 시간이 지나도 누구나 알아보기 쉬운 코드를 작성하면 된다! 어떻게? 코드 리뷰를 통해서!

### 1\. S/W 장인정신

1.1. 지식과 경험의 공유를 통해 전문성을 갖춘 개발자를 육성하자
=> 현재 Dooray wiki 를 통한 지식 공유외에 경험을 공유할 수 있는 방법? 코드 리뷰

## 코드 리뷰

### 1\. 코드 리뷰의 목적

1.1. 주목적은 버그, 장애 등을 발견함으로써 품질 문제를 검수할 수 있다.
1.2. 아키텍처 속성을 개선할 수 있는 활동이며 향후 유지보수 비용을 줄일 수 있다.
1.3. 리뷰이뿐만 아니라 리뷰어도 리뷰 과정을 통해 하드 스킬, 소프트 스킬을 얻을 수 있다.
1.4. 동기부여가 될 수 있다.
1.5. 상호 책임감 증대, 개발 문화 개선 및 설계 개선 제안을 할 수 있다.
=> 단순 코드 레벨에서뿐 아니라 인프라, 아키텍처 관점에서도 생각해보기!

### 2\. 코드 리뷰의 절차

* 구성: 저자(리뷰이), 리뷰어, 변경 내역(PR)

2.1. 리뷰이가 MR 또는 PR 을 통해서 코드 리뷰를 요청할 수 있는 양식을 필요하다.
2.2. 리뷰이가 먼저 솔선수범하여 구체적으로 메시지를 작성해야 리뷰어들이 리뷰를 하는 시간을 아껴 선순환이 이루어진다.

### 3\. 코드 리뷰가 어려운 이유?

3.1. 코드에 대한 비판을 자신에 대한 비판으로 오해한다. 그러므로 상호간에 주의가 필요하다.
3.2. 공유(잘한 것, 아쉬운 것)를 통해 서로의 지식과 경험을 나누어야 한다.
3.3. 생각을 글로 전하는 것에 대한 어려움이 있다.

## 기법들

### 1\. 효율적인 PR 방법

1.1. 지루한 작업은 컴퓨터로 처리, 즉 자동화 또는 Formatting Tool 등을 이용한다.
1.2. 스타일 가이드 준수 (\*기존 것 차용, 새로운 것 생성, 잘 융합)
1.3. PR 요청시 주석 달기! + 리뷰이가 작성 후 먼저 읽어 보고 주의 깊게 봐줬으면 하는 부분이 있다면 해당 내용까지 같이 작성
1.4. 최대한 많은 사람이 참여
1.5. 의미있는 커밋으로 분리해야 시간이 흘러도 한 눈에 확인할 수 있다.

### 2\. 효율적인 리뷰 방법

2.1. 너무 많은 양의 코드를 한 번에 하지 않고 적절한 기준으로 나누어 PR 한다

* PR 을 한번에 해야하는 경우 커밋을 기능별로 여러번 나누어 작성하고, 리뷰어들이 중점으로 보아야할 커밋 내용을 작성한다.

<br>
2.2. PR, Pair Programming 을 구성원들의 내성적, 외성적 성향에 따라 적절히 혼합하여 사용하면 좋은 효과를 얻을 수 있다.

<br>
2.3. 리뷰어들은 너무 많은 피드백을 남기기보다 고수준 피드백을 우선으로 해야한다.

* 버그, 장애, 성능, 보안 등
* Extract Method, Composed Method, Invert-if, Time Complexity 등

<br>
2.4. 짧은 예제를 통해 리뷰어들의 이해를 도울 수 있다.

<br>
2.5. 태그를 활용함으로써 효과적으로 내용을 전달할 수 있다.

* [Nit] = 고치면 좋지만 아니어도 괜찮다\~
    * 혹시 리뷰어들이 "이런것도 적어도 되나?" 싶은 내용도 자유롭게 의견을 남길 수 있다.
    * 리뷰어는 항상 더 개선할 수 있는 의견을 자유롭게 남길 수 있어야한다!

<br>
2.6. 리뷰이의 코드 수준을 한 번에 올리려 하지 말고 단계적으로 조금씩 올릴 수 있도록 피드백 해야한다.

* Letter Grade
* 완전하지는 않아도 충분히 좋은 코드가 되도록

<br>
2.7. 절대 "너" 라는 호칭 사용하지 말고, 상호간에 존중해야한다.

* 코드 리뷰의 핵심은 잘잘못을 따지는 것이 아니라 코드를 더 좋아지게 하기 위함이다.
* 비판의 대상은 저자가 아니라 코드여야한다!

<br>
2.8. 진심어린 칭찬을 아끼지마라!

* 코드의 개선점만을 찾기보다는 좋은 점이 있다면 그 부분도 칭찬해줘라!
* 칭찬을 통해 자신감을 가질 수 있고, 기분도 좋아진다\~

<br>
2.9. 피드백은 명령이 아니라 요청이어야한다!

* 리뷰시 강압적으로 명령하는 형태보다는 권유, 요청하는 형태로 작성해야한다.

<br>
2.10. 주관적인 의견이 아니라 원칙에 기반하여 피드백해라!

* "제안하는 변경 방법", "이유" 를 함께 설명해라!

<br>
2.11. 반복적인 패턴에 대해서 피드백을 제한해라!

* PR에서 동일한 실수가 여러번 발견될시 모든 실수를 피드백하기보다 일부만 해라
    * 일부만 하더라도 리뷰이가 성장함으로써 자신의 실수를 스스로 찾아 개선할 수 있다.
    * 피드백 한번으로 단순간에 개선되지 않는다! 꾸준한 피드백, 기다림이 필요하다.

### 3\. 어떻게 시작해야할까?

3.1. 처음에는 온라인에서 토론 형태로 진행 (처음부터 오프라인으로 진행하면 꾸중이 될 수 있음)

3.2. 무엇보다 리뷰이의 노력이 중요! 리뷰이가 상세히 내용을 작성해야 리뷰어들의 시간을 아낄 수
있다.

3.3. 리더의 관심과 의지가 중요! 리더와 구성원들 모두가 함께하고자 해야한다.

## Appendix

1. 매일 리팩토링

* Composed Method (Extract Method)
* 응집도 높이기
* Discover Value Object

## 용어

하드 스킬: 직무에 특정한 구체적인 기술이며, 실제로 업무를 수행하는 데 필요한 기술
소프트 스킬: 모든 직무에서 사용할 수 있는 대인 관계 또는 피플 스킬
MR:
PR:
Pair Programming: 두 사람이 같이 프로그래밍하는 행위
(코드) 스타일 가이드: 코드 작성시 사용되는 가이드라인 또는 규칙
Extract Method: 코드 덩어리를 별도의 메서드로 뽑아내는 방법
Composed Method: 메서드 정리하는 것을 통칭하는 방법
Invert-if: 코드의 의미를 변경하지 않고 if 또는 if else 문을 반전하는 것
Time Complexity: 시간 복잡성, 입력 데이터에 대하여 문제를 해겨하는데 소요되는 시간

## Reference

[1] 하드 스킬 vs. 소프트 스킬 - 주요 차이점, [https://brunch.co.kr/@softskillsup/5](https://brunch.co.kr/@softskillsup/5)
[2]
&#91;3&#93; &#91;Agile&#93; 짝 프로그래밍\(Pair Programming\)이란\, [https://gmlwjd9405.github.io/2018/07/02/agile-pair-programming.html](https://gmlwjd9405.github.io/2018/07/02/agile-pair-programming.html)
[4] Programming style, [https://en.wikipedia.org/wiki/Programming\_style](https://en.wikipedia.org/wiki/Programming_style)
[5] Extract Method, [https://wikidocs.net/608](https://wikidocs.net/608)(:star2:)
[6] 메소드 정리(Composing Method), [https://wikidocs.net/600](https://wikidocs.net/600)
